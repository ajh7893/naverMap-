<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home Page</title>

    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=ebw9oxmgrs"></script>
    <!--<script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=ebw9oxmgrs&amp;submodules=panorama,geocoder,drawing,visualization"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/data/data.js"></script>

    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps-panorama.js"></script>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps-geocoder.js"></script>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps-drawing.js"></script>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps-visualization.js"></script>
</head>
<body>

<div id="wrap" class="section">
    <p>ì§€ë„ì— ê²½ë¡œë° ë§ˆí¬ í‘œì‹œ ê¸°ë³¸ì ì¸ ì˜ˆì œì…ë‹ˆë‹¤.</p>
    <div id="map" style="width:100%;height:600px;"></div>
</div>
<div style="display:inline;">
    <button style="padding:10px 10px; margin:2px;" id="drawSingle" class="btn">ë‹¨ì¼ í´ë¦¬ë¼ì¸ìœ¼ë¡œ ê·¸ë¦¬ê¸°</button>
    <button style="padding:10px 10px; margin:2px;" id="drawMulti" class="btn">ë©€í‹° í´ë¦¬ë¼ì¸ìœ¼ë¡œ ê·¸ë¦¬ê¸°</button>
    <button style="padding:10px 10px; margin:2px;" id="remove" class="btn">í´ë¦¬ë¼ì¸ ì‚­ì œ</button>
</div>

<script>
        var latitude, longitude;

        // ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        navigator.geolocation.getCurrentPosition(
            (position) => {
                latitude = position.coords.latitude; // ìœ„ë„
                longitude = position.coords.longitude; // ê²½ë„

                console.log(`ìœ„ë„: ${latitude}, ê²½ë„: ${longitude}`);

                // ğŸ“Œ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ í›„ ì§€ë„ ì´ˆê¸°í™”
                initMap(latitude, longitude);
            },
            (error) => {
                console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­)ë¡œ ì§€ë„ ì´ˆê¸°í™”
                initMap(37.5666805, 126.9784147);
            }
        );

        // ğŸ“Œ ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜ (ë¹„ë™ê¸° ìˆœì„œ í•´ê²°)
        function initMap(lat, lng) {
            var map = new naver.maps.Map('map', {
                zoom: 15,
                center: new naver.maps.LatLng(lat, lng)
            });

            // ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€
            var userMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(lat, lng),
                map: map1
            });

            // ì„œìš¸ ì‹œì²­ ìœ„ì¹˜ ë§ˆì»¤ ì¶”ê°€ 126.5349, 37.7798
            var cityhall = new naver.maps.LatLng(37.5666805, 126.9784147);
            var marker2 = new naver.maps.Marker({
                position: cityhall,
                map: map1
            });

            var contentString = [
                '<div class="iw_inner">',
                '   <h3>ì„œìš¸íŠ¹ë³„ì‹œì²­</h3>',
                '   <p>ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ1ê°€ 31 | ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110 ì„œìš¸íŠ¹ë³„ì‹œì²­<br />',
                '       <img src="/img/sally.png" width="55" height="55" alt="ì„œìš¸ì‹œì²­" class="thumb" /><br />',
                '       02-120 | ê³µê³µ,ì‚¬íšŒê¸°ê´€ &gt; íŠ¹ë³„,ê´‘ì—­ì‹œì²­<br />',
                '       <a href="http://www.seoul.go.kr" target="_blank">www.seoul.go.kr/</a>',
                '   </p>',
                '</div>'
            ].join('');

            var infowindow = new naver.maps.InfoWindow({
                content: contentString
            });

            naver.maps.Event.addListener(marker2, "click", function (e) {
                if (infowindow.getMap()) {
                    infowindow.close();
                } else {
                    infowindow.open(map1, marker2);
                }
            });

            infowindow.open(map1, marker2);

            // ì§€ë„ í´ë¦­ ì‹œ ë§ˆì»¤ ì¶”ê°€ ê¸°ëŠ¥
            var markerList = [];

            naver.maps.Event.addListener(map1, 'click', function (e) {
                var marker = new naver.maps.Marker({
                    position: e.coord,
                    map: map1
                });

                markerList.push(marker);
            });

            // ì§€ë„ ìš°í´ë¦­ ì‹œ ì¢Œí‘œ í‘œì‹œ
            var menuLayer = $('<div style="position:absolute;z-index:10000;background-color:#fff;border:solid 1px #333;padding:10px;display:none;"></div>');
            map1.getPanes().floatPane.appendChild(menuLayer[0]);
            naver.maps.Event.addListener(map1, 'rightclick', function (e) {
                var coordHtml =
                    'Coord: ' + '(ìš° í´ë¦­ ì§€ì  ìœ„/ê²½ë„ ì¢Œí‘œ)' + '<br />' +
                    'Point: ' + e.point + '<br />' +
                    'Offset: ' + e.offset;

                menuLayer.show().css({
                    left: e.offset.x,
                    top: e.offset.y
                }).html(coordHtml);

                console.log('Coord: ' + e.coord.toString());
            });

            // ì„  ê·¸ë¦¬ê¸° (í´ë¦¬ë¼ì¸)
            var polyline; // ì „ì—­ ë³€ìˆ˜

            function drawSingle() {
                if (polyline) {
                    polyline.setMap(null);
                }
                remove();

                polyline = new naver.maps.Polyline({
                    path: polylinePath, // ì„  ìœ„ì¹˜ ë³€ìˆ˜ë°°ì—´
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 6,
                    map: map1
                });
            }

            function drawMulti() {
                if (polyline) {
                    polyline.setMap(null);
                }
                remove();

                polyline = new naver.maps.Polyline({
                    path: polylinePath2,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 6,
                    map: map1
                });

                console.log('polylinePath2');
                console.log(polylinePath2);
            }

            function remove() {
                console.log('remove');
                if (polyline) {
                    polyline.setMap(null);
                    polyline = null;
                }
            }

            $('#drawSingle').on('click', drawSingle);
            $('#drawMulti').on('click', drawMulti);
            $('#remove').on('click', remove);
        }
    </script>
</body>
</html>